---
import { languages, getTranslatedUrl, type Lang } from '../i18n/index';

interface Props {
  lang: Lang;
  slug?: string;
  translations?: Record<string, string>;
}

const { lang, slug = '', translations = {} } = Astro.props;
const currentLang = languages[lang];
---

<div class="relative group">
  <button
    class="flex items-center gap-1 px-3 py-2 text-sm text-white/80 hover:text-sitehub-accent transition-colors"
    aria-label="Switch language"
  >
    <span>{currentLang.flag}</span>
    <span class="hidden sm:inline">{currentLang.name}</span>
    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
    </svg>
  </button>
  <div class="absolute right-0 top-full hidden group-hover:block bg-sitehub-dark border border-white/10 rounded-md shadow-xl min-w-[140px] py-1 z-50">
    {(Object.entries(languages) as [Lang, { name: string; flag: string }][]).map(
      ([code, { name, flag }]) => (
        <a
          href={getTranslatedUrl(code, slug, translations)}
          class:list={[
            'flex items-center gap-2 px-4 py-2 text-sm transition-colors',
            code === lang
              ? 'text-sitehub-accent bg-white/5'
              : 'text-white/80 hover:text-sitehub-accent hover:bg-white/5',
          ]}
        >
          <span>{flag}</span>
          <span>{name}</span>
        </a>
      ),
    )}
  </div>
</div>
